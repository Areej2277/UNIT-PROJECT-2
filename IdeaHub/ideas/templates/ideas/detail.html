{% extends 'core/base.html' %}
{% block content %}
<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-body">
            <h2 class="card-title">{{ idea.title }}</h2>
            <p class="text-muted"><strong>Category:</strong> {{ idea.get_category_display }}</p>
            <p class="card-text">{{ idea.description }}</p>
            <p class="text-muted"><em>By {{ idea.user.username }} on {{ idea.created_at|date:"F d, Y H:i" }}</em></p>

            <!-- أزرار الإعجاب والشراكة -->
            <div class="d-flex gap-2">
                <form method="POST" action="{% url 'likes:like' idea.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-primary">
                        <i class="fas fa-thumbs-up"></i> 
                        {% if request.user in idea.likes.all %}
                            Unlike ({{ idea.likes.count }})
                        {% else %}
                            Like ({{ idea.likes.count }})
                        {% endif %}
                    </button>
                </form>

                {% if request.user.is_authenticated %}
                    <form method="POST" action="{% url 'partnerships:request' idea.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-success">
                            <i class="fas fa-handshake"></i>
                            {% if request.user in idea.partnerships.all.values_list.user %}
                                Cancel Request
                            {% else %}
                                Request Partnership
                            {% endif %}
                        </button>
                    </form>
                {% endif %}
            </div>
            
            <hr>

            <!-- عرض التعليقات -->
            <h4 class="mt-4">Comments:</h4>
            <ul class="list-group">
                {% for comment in idea.comments.all %}
                    <li class="list-group-item">
                        <strong>{{ comment.user.username }}:</strong> {{ comment.content }}
                        <span class="text-muted float-end">{{ comment.created_at|date:"F d, Y H:i" }}</span>
                    </li>
                {% empty %}
                    <li class="list-group-item">No comments yet.</li>
                {% endfor %}
            </ul>

            <!-- إضافة تعليق -->
            {% if user.is_authenticated %}
                <a href="{% url 'comments:add' idea.id %}" class="btn btn-primary mt-3">
                    <i class="fas fa-comment"></i> Add Comment
                </a>
            {% else %}
                <p class="mt-3"><a href="{% url 'users:login' %}">Sign in</a> to comment.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}